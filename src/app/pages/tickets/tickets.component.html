<!-- Listing and total number of counts -->
<div class="row" *ngIf="showStats" style="display:flex; justify-content: center;">
  <div class="topcard-item col-sm-6 col-lg-3">
    <mat-card class="text-center" [ngClass]="{'card-active': selectedCategory === ''}" (click)="btnCategoryClick('')">
      <mat-card-content class="card-pointer">
        <img
          src="/assets/images/ticketsAll.png"
          alt="users"
          width="70" />
        <h4 class="f-s-14 f-w-600 text-primary m-t-8">
          {{ 'todos' | translate }}
        </h4>
        <h6 class="f-s-21 f-w-600 text-primary m-t-8">
          {{ totalCount }}
        </h6>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="topcard-item col-sm-6 col-lg-3">
    <mat-card class="text-center" [ngClass]="{'card-active': selectedCategory === ''}" (click)="btnCategoryClick('InProgress')">
      <mat-card-content class="card-pointer">
        <img
          src="/assets/images/ticketPending.png"
          alt="users"
          width="70" />
        <h4 class="f-s-14 f-w-600 text-primary m-t-8">
          {{ 'pendiente' | translate }}
        </h4>
        <h6 class="f-s-21 f-w-600 text-primary m-t-8">
          {{ countTicketsByStatus("pendiente") }}
        </h6>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="topcard-item col-sm-6 col-lg-3">
    <mat-card class="text-center" [ngClass]="{'card-active': selectedCategory === ''}" (click)="btnCategoryClick('Open')">
      <mat-card-content class="card-pointer">
        <img
          src="/assets/images/ticketProcessing.png"
          alt="users"
          width="70" />
        <h4 class="f-s-14 f-w-600 text-primary m-t-8">
          {{ 'en_proceso' | translate }}
        </h4>
        <h6 class="f-s-21 f-w-600 text-primary m-t-8">
          {{ countTicketsByStatus("en_proceso") }}
        </h6>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="topcard-item col-sm-6 col-lg-3">
    <mat-card class="text-center" [ngClass]="{'card-active': selectedCategory === ''}" (click)="btnCategoryClick('Closed')">
      <mat-card-content class="card-pointer">
        <img
          src="/assets/images/ticketSolved.png"
          alt="users"
          width="70" />
        <h4 class="f-s-14 f-w-600 text-primary m-t-8">
          {{ 'resuelto' | translate }}
        </h4>
        <h6 class="f-s-21 f-w-600 text-primary m-t-8">
          {{ countTicketsByStatus("resuelto") }}
        </h6>
      </mat-card-content>
    </mat-card>
  </div>

</div>

<!-- Add and search tickets -->
<mat-card class="cardWithShadow" *ngIf="!compact">
  <mat-card-content>
    <div class="row justify-content-between gap-16">
      <div class="col-sm-4">
        <mat-form-field appearance="outline" class="hide-hint">
          <input
            matInput
            (keyup)="onKeyup($event)"
            [placeholder]="'buscar_tickets' | translate" />
          <mat-icon matSuffix>
            <i-tabler name="search" class="icon-20 d-flex m-t-2"></i-tabler>
          </mat-icon>
        </mat-form-field>
      </div>
      <div class="col-sm-4 d-flex justify-content-end align-items-center">
        <button mat-flat-button color="primary" (click)="openDialog('Add', {})">
          {{ 'anadir_ticket' | translate }}
        </button>
      </div>
    </div>
  </mat-card-content>
</mat-card>

<!-- Tabla y paginador -->
<div *ngIf="compact; else normalTicketsCard" class="b-1 rounded">
  <div class="table-responsive">
    <!-- Buscador y botÃ³n arriba, igual que en pedidos -->
    <div class="justify-content-between gap-16 d-flex align-items-center b-b-1"
      style="height: 71px;">
      <div class="d-flex align-items-center justify-content-between"
        style="margin-left: 29px !important;">
        <mat-form-field appearance="outline" class="hide-hint"
          style="min-width:320px; flex:1; max-width:500px;">
          <input matInput (keyup)="onKeyup($event)"
            [placeholder]="'buscar_tickets' | translate" />
          <mat-icon matSuffix>
            <i-tabler name="search" class="icon-20 d-flex m-t-2"></i-tabler>
          </mat-icon>
        </mat-form-field>
        <button mat-flat-button color="primary"
          class="d-flex justify-content-center align-items-center"
          [routerLink]="['/tickets']" style="left: 200px; width: 120px;">
          {{ 'ir_ticket' | translate }}
        </button>
      </div>
    </div>
    <table mat-table [dataSource]="dataSource" class="w-100 f-w-500 no-wrap">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">#</th>
        <td mat-cell *matCellDef="let element">{{ element.id }}</td>
      </ng-container>

      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
          {{ 'titulo' | translate }}
        </th>
        <td mat-cell *matCellDef="let element">{{ element.tipo_nombre }}</td>
      </ng-container>
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
          {{ 'descripcion' | translate }}
        </th>
        <td mat-cell *matCellDef="let element">
          {{element.comentarios_internos}}
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
          {{ 'estado' | translate }}
        </th>
        <td mat-cell *matCellDef="let element">
          <span
            class="bg-light f-w-500 p-x-8 p-y-4 rounded-pill f-s-12"
            [ngClass]="{
              'bg-light-warning': element.estado === 'en_proceso',
              'bg-light-success': element.estado === 'resuelto',
              'bg-light-error': element.estado === 'pendiente'
            }">
            {{ element.estado | translate | titlecase }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="prioridad">
        <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
          {{ 'prioridad' | translate }}
        </th>
        <td mat-cell *matCellDef="let element">
          <span
            class="bg-light f-w-500 p-x-8 p-y-4 rounded-pill f-s-12"
            [ngClass]="{
              'bg-light-warning': element.prioridad === 'media',
              'bg-light-info': element.prioridad === 'baja',
              'bg-light-error': element.prioridad === 'alta'
            }">
            {{ element.prioridad | translate | titlecase }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef
          class="f-s-16 f-w-600">{{ 'fecha' | translate }}</th>
        <td mat-cell *matCellDef="let element" class="f-s-14">
          {{ element.fecha_creacion | date:'dd/MM/yyyy - HH:mm:ss' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element" style="text-align: right;">
          <button mat-stroked-button color="accent"
            style="margin-right:.5em;"
            (click)="openDialog('Update', element)">
            {{ 'editar' | translate }}
          </button>
          <button mat-flat-button color="primary"
            (click)="openDialog('View', element)">
            {{ 'detalles' | translate }}
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
  <mat-paginator class="b-t-1"
    style="border-radius: 0px 0px 10px 10px !important"
    [pageSizeOptions]="[5,10,20]"
    [pageSize]="ticketsPorPagina"
    showFirstLastButtons>
  </mat-paginator>
</div>

<ng-template #normalTicketsCard>
  <mat-card class="cardWithShadow">
    <mat-card-content>
      <div class="table-responsive">
        <table mat-table [dataSource]="dataSource"
          class="w-100 f-w-500 no-wrap">
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">#</th>
            <td mat-cell *matCellDef="let element">{{ element.id }}</td>
          </ng-container>

          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
              {{ 'titulo' | translate }}
            </th>
            <td mat-cell *matCellDef="let element">{{ element.tipo_nombre
              }}</td>
          </ng-container>
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
              {{ 'descripcion' | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              {{element.comentarios_internos}}
            </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
              {{ 'estado' | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              <span
                class="bg-light f-w-500 p-x-8 p-y-4 rounded-pill f-s-12"
                [ngClass]="{
                  'bg-light-warning': element.estado === 'en_proceso',
                  'bg-light-success': element.estado === 'resuelto',
                  'bg-light-error': element.estado === 'pendiente'
                }">
                {{ element.estado | translate | titlecase }}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="prioridad">
            <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
              {{ 'prioridad' | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              <span
                class="bg-light f-w-500 p-x-8 p-y-4 rounded-pill f-s-12"
                [ngClass]="{
                  'bg-light-warning': element.prioridad === 'media',
                  'bg-light-info': element.prioridad === 'baja',
                  'bg-light-error': element.prioridad === 'alta'
                }">
                {{ element.prioridad | translate | titlecase }}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef
              class="f-s-16 f-w-600">{{ 'fecha' | translate }}</th>
            <td mat-cell *matCellDef="let element" class="f-s-14">
              {{ element.fecha_creacion | date:'dd/MM/yyyy - HH:mm:ss' }}
            </td>
          </ng-container>

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element" style="text-align: right;">
              <button mat-stroked-button color="accent"
                style="margin-right:.5em;"
                (click)="openDialog('Update', element)">
                {{ 'editar' | translate }}
              </button>
              <button mat-flat-button color="primary"
                (click)="openDialog('View', element)">
                {{ 'detalles' | translate }}
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
      <mat-paginator class="b-t-1"
        style="border-radius: 0px 0px 10px 10px !important"
        [pageSizeOptions]="[5,10,20]"
        [pageSize]="ticketsPorPagina"
        showFirstLastButtons></mat-paginator>
    </mat-card-content>
  </mat-card>
</ng-template>
